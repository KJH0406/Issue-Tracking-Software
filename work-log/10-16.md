# **🗓️** Daily Work Log

## [2024-10-16] 4hours

### 🎯 오늘의 목표

- [x] Appwrite 및 데이터베이스 설정
  - [x] Appwrite 서버 설치 및 설정
- [x] Session Middleware 구축
  - [x] 세션 관리 로직 구현
  - [x] 세션 만료 처리
- [x] 라우트 보호 학습 및 적용
  - [x] 인증이 필요한 라우트 보호 방법 학습

### 📝 완료한 작업

- **Session Middleware 구현**
  - `sessionMiddleware`를 통해 클라이언트 쿠키에서 세션 정보를 읽어 인증된 사용자만 접근하도록 라우트 보호
  - 세션이 없거나 만료된 경우 `401 Unauthorized` 응답 반환
  - `Appwrite`와 연동하여 사용자 계정 및 세션 관리 수행
- **인증 API 구현**
  - 로그인 및 회원가입 API 구현:
    - `POST /login`: 사용자 로그인 처리 및 세션 쿠키 설정
    - `POST /register`: 회원가입 처리 후 자동 로그인 및 세션 쿠키 설정
  - Tanstack Query와 `useMutation`을 사용하여 클라이언트 측에서 로그인 및 로그아웃 요청 처리
  - `useCurrent` 훅을 통해 현재 사용자 상태를 관리, 인증되지 않은 사용자는 로그인 페이지로 리디렉션
  - `useLogin`, `useLogout` 훅 수정하여 클라이언트에서 세션 기반 로그인/로그아웃 처리

### 🧠 배운 점

1. `server only`
   - 키가 클라이언트(사용자 브라우저)에 노출되면 악의적인 사용자가 이를 이용해 Appwrite 서버에 무단으로 접근할 수 있음
   - `server-only`를 사용하여 코드를 서버에서만 실행되도록 강제하면, 클라이언트 측에서는 이러한 민감한 정보에 접근할 수 없음
   - 즉, API 키, 프로젝트 ID, 엔드포인트 URL 등 민감한 정보는 **서버에만 존재하**도록 강제
2. Session-middleware 설정
   - **세션 기반 인증**을 처리하기 위한 미들웨어 설정
   - **세션 검증을 위하여** 쿠키에 저장된 세션 정보를 가져와 유효한지 확인하였음
     - 세션 기반 미들웨어는 사용자가 로그인한 후 부여받은 세션 쿠키를 활용하여 요청이 들어올 때마다 **사용자가 인증된 상태인지 확인**
   - 이를 통해 매번 로그인하지 않고도 사용자 상태를 유지하면서 작업을 할 수 있었음
   - 미들웨어 설정은 사용자 상태에 따라 다른 기능을 제공하거나, 특정 데이터에 접근할 수 있게 확장 할 수 있음

### 🚧 진행 중인 작업

- 모두 완료

### 🛑 트러블 슈팅

- 발생한 문제 없음

### 📊 향후 계획

- [ ] 대시보드 레이아웃 구현
- [ ] 워크 스페이스 구현

### 💡 기타 메모

오늘은 세션 기반 미들 웨어를 설정하고, 인증 관리를 하였음. 확실히 CS가 부족하여 네트워크 관계라던지, 동작 방식에 대해서 이해하는데 많이 오래걸렸음. 향후 복습 과정 필요
